<html>
<head>
<style>
body{
  margin: 0;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var controller = function(){
  var obj = null;
  this.attachTo = function( newObj ){
    obj = newObj;
  };
  var mappings = {
    'w' : function(){
      obj.vy -= 10;
    },
    'a': function(){
      obj.vx -= 10;
    },
    's': function(){
      obj.vy += 10;
    },
    'd': function(){
      obj.vx += 10;
    }
  };
  document.addEventListener("keypress", function(e){
    for(var i in mappings){
      if(i == String.fromCharCode(e.charCode)){
        mappings[i]();
      }
    }
  });
};

var obj = function(){
  this.x = 0;
  this.y = 0;
  this.width = 50;
  this.height = 50;
  this.vx = 5;
  this.vy = 5;
  this.render = function( context ){
    context.beginPath();
    context.fillRect( this.x, this.y, this.width, this.height );
    context.stroke();
  };
};

var scene = function(){
  this.fps = 50;
  this.interval = 1 / this.fps * 1000;
  this.children = [];
  this.now = 0;
  this.past = 0;
  this.diff = 0;
  this.context = ctx;
  this.addChild = function( obj ){
    this.children.push( obj );
  };
  this.setContext = function( context ){
    this.context = context;
  };
  this.render = function(){
    for( var i in this.children ){
      var child = this.children[i];
      this.context.fillRect( child.x, child.y, child.width, child.height );
    }
  };
  this.clear = function(){
    this.context.clearRect( 0, 0, canvas.width, canvas.height );
  };
  this.tick = function(){
    this.clear();
    this.now = new Date().getTime();
    if( this.past > 0 ) {
      this.diff = this.now - this.past;
    }
    else {
      this.diff = this.interval;
    }
    this.past = this.now;
    for( var i = 0; i < this.children.length; i++ ){
      var child = this.children[i];
      child.x += child.vx * ( this.diff / this.interval );
      child.y += child.vy * ( this.diff / this.interval );
      //out of bounds checks
      if( child.x < 0 || child.x > canvas.width ) {
        child.vx *= -1;
        child.x = child.x < 0 ? 0 : canvas.width;
      }
      if( child.y < 0 || child.y > canvas.height ) {
        child.vy *= -1;
        child.y = child.y < 0 ? 0 : canvas.height;
      }
      for( var j = i + 1; j < this.children.length; j++ ){
        var child2 = this.children[j];
        if( collides( child, child2 ) ){
          child.vx *= -1;
          child.vy *= -1;
          child2.vx *= -1;
          child2.vy *= -1;
        }
      }
      child.render( ctx );
    }
  };
};

var collides = function( obj1, obj2 ){
  if( (obj1.x + obj1.width > obj2.x) && (obj2.x + obj2.width > obj1.x) ){
    if( (obj1.y + obj1.height > obj2.y) && (obj2.y + obj2.height > obj1.y) ){
      return true;
    }
  }
  else {
    return false;
  }
};

var fixOffset = function( obj1, obj2 ){
  if( obj2.x > obj1.x + obj1.width/2 && obj2.x < obj1.x + obj1.width){

  }
};

var background = new scene();
/*
for(var i = 0; i < 10; i++ ){
  var a = new obj();
  a.x = Math.floor(Math.random() * canvas.width);
  a.y = Math.floor(Math.random() * canvas.height);
  a.width = 50//Math.floor(Math.random() * 50) + 50;
  a.height = 50//Math.floor(Math.random() * 50) + 50;
  c.addChild(a);
}
*/
var player = new obj();
var keyboard = new controller();
keyboard.attachTo(player);
background.addChild(player);

setInterval( function(){background.tick();}, background.interval )

</script>
</body>
</html>
