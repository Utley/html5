<html>
<head>
<style>
body{
  margin: 0;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var obj = function(){
  this.x = 0;
  this.y = 0;
  this.width = 50;
  this.height = 50;
  this.vx = 5;
  this.vy = 5;
  this.render = function( context ){
    context.beginPath();
    context.fillRect( this.x, this.y, this.width, this.height );
    context.stroke();
  };
};

var scene = function(){
  this.fps = 50;
  this.interval = 1 / this.fps * 1000;
  this.children = [];
  this.now = 0;
  this.past = 0;
  this.diff = 0;
  this.context = ctx;
  this.addChild = function( obj ){
    this.children.push( obj );
  };
  this.setContext = function( context ){
    this.context = context;
  };
  this.render = function(){
    for( var i in this.children ){
      var child = this.children[i];
      this.context.fillRect( child.x, child.y, child.width, child.height );
    }
  };
  this.clear = function(){
    this.context.clearRect( 0, 0, canvas.width, canvas.height );
  };
  this.tick = function(){
    this.clear();
    this.now = new Date().getTime();
    if( this.past > 0 ) {
      this.diff = this.now - this.past;
    }
    else {
      this.diff = this.interval;
    }
    this.past = this.now;
    for( var i = 0; i < this.children.length; i++ ){
      var child = this.children[i];
      child.x += child.vx * ( this.diff / this.interval );
      child.y += child.vy * ( this.diff / this.interval );
      //out of bounds checks
      if( child.x < 0 || child.x > canvas.width ) {
        child.vx *= -1;
        child.x = child.x < 0 ? 0 : canvas.width;
      }
      if( child.y < 0 || child.y > canvas.height ) {
        child.vy *= -1;
        child. y = child.y < 0 ? 0 : canvas.height;
      }
      for( var j = i + 1; j < this.children.length; j++ ){
        var child2 = this.children[j];
        if( (child.x + child.width > child2.x) && (child2.x + child2.width > child.x) ){
          if( (child.y + child.height > child2.y) && (child2.y + child2.height > child.y) ){
            child.vx *= -1;
            child.vy *= -1;
            child2.vx *= -1;
            child2.vy *= -1;
            if( child.x > child2.x ){
              child.x -= (child2.x - child.x);
            }
            else {
              child2.x -= (child.x - child2.x);
            }
            if( child.y > child2.y ){
              child.y -= (child2.y - child.y);
            }
            else {
              child2.y -= (child.y - child2.y);
            }
          }
        }
      }
      child.render( ctx );
    }
  };
};
var a = new obj();
var b = new obj();
b.x = 500;
b.y = 500;
var c = new scene();
c.addChild(a);
c.addChild(b);
for(var i = 0; i < 50; i++ ){
  var a = new obj();
  a.x = Math.floor(Math.random() * canvas.width);
  a.y = Math.floor(Math.random() * canvas.height);
  a.width = Math.floor(Math.random() * 50) + 10;
  a.height = Math.floor(Math.random() * 50) + 10;
  c.addChild(a);
}
setInterval( function(){c.tick();}, c.interval )

</script>
</body>
</html>
